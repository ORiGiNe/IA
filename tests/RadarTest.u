requireFile("../core/Radar.u");

var log = Logger.new("main")|;

log.log << "Start"|;

//var g = UGaop.new("/dev/ttyUSB1");
//var s = UCapteur.new(4,g);
//g.initialise;

var s = Object.new|;
function s.get
{
    return 30
}|;

var opponent = Event.new|;

var r = Radar.new([Sonar.new(s,20,32)],opponent)|;

log.log << "mise à jour de posMonitored"|;
r.posMonitored = [20]|;
r.delay = 1s|;
log.log << "Monitoring started"|;

var state = "normal"|;

at (opponent?)
    log.log << "OPPONENT ???";

whenever (opponent? ~ 2s)
    if (state != "crisis") {
		    state = "crisis";
		    log.log << "OPPONENT !!!";

		    l: every (1s) {
			    log.log << "working"
		    },

		    sleep(2);
		    l.stop;
            log.log << "work done";
		    state = "crisi"
    };

sleep(2s);
s.get = function {
    return 4
}|;

sleep(4s);
s.get = function {
    return 40
}|;

sleep(4s);
s.get = function {
    return 4
}|;

sleep(1);
s.get = function {
    return 35
}|;

sleep(3);
log.log << "mise à jour de posMonitored"|;
r.posMonitored = [32]|;
s.get = function {
    return 10
}|;

sleep(3);
log.log << "mise à jour de posMonitored"|;
r.posMonitored << 20|;

sleep(4);
s.get = function {
    return 42
}|;

sleep(6);
log.log << "STOP !!!"|;
r.stop;
